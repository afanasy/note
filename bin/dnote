#!/usr/bin/env node
'use strict';
process.title = process.bin = 'dnote';
var Path = require('path'),
    portfinder = require('portfinder'),
    opener = require('opener'),
    parser = require("nomnom"),
    note = require(Path.join(__dirname,'../index.js'));

parser.option('version', {
  flag: true,
  help: 'print version and exit',
  abbr: 'v',
  callback: function() {
    var pkg = require(Path.join(__dirname,'../package.json'));
    return pkg.name + '@' + pkg.version;
  }
});

var serve = function(opts) {
  var config = {};
  if(opts[1]) { 
    config.content = Path.resolve(opts[1]); 
  } else { 
    config.content = process.cwd();
  }
  note.start(config);
};
parser.command('serve').callback(serve)
.help("Serve the markdown files on the give path (defaults to the current directory).");

var generate = function(opts) {
  var config = {};
  console.log(opts)
  if(opts[1]) { 
    config.content = Path.resolve(opts[1]); 
  } else { 
    config.content = process.cwd();
  }
  note.generate(config);
};
parser.command('site')
.option('outdir', {
    abbr: 'o',
    help: "directory to save html files"
 })
.callback(generate)
.help("Generate a website from the markdown files on the give path (defaults to the current directory).");

parser.parse();