#!/usr/bin/env node
'use strict';
process.title = process.bin = 'dnote';
var Path = require('path'),
    portfinder = require('portfinder'),
    opener = require('opener'),
    parser = require("nomnom"),
    note = require(Path.join(__dirname,'../index.js'));
/*
 * Option: version
 */
parser.option('version', {
  flag: true,
  help: 'prints the current dnote version',
  abbr: 'v',
  callback: function() {
    var pkg = require(Path.join(__dirname,'../package.json'));
    return pkg.name + '@' + pkg.version;
  }
});
/*
 * Method: serve
 */
var serve = function(opts) {
  var config = {};
  if(opts[1]) { 
    config.content = Path.resolve(opts[1]); 
  } else { 
    config.content = process.cwd();
  }
  note.start(config);
};
parser.command('serve').callback(serve)
.help("serve the .md files on a given folder (defaults to current folder)");
/*
 * Method: save
 */
var save = function(opts) {
  var config = {};
  if(opts[1]) { 
    config.content = Path.resolve(opts[1]); 
  } else { 
    config.content = process.cwd();
  }
  if(opts.out) {
    config.outputPath = opts.out; 
  }
  if(opts.dirname) {
    config.outputDir = opts.out; 
  }
  note.save(config);
};
parser.command('save')
.option('out', {
    abbr: 'o',
    help: "the path in which we'll create a folder to save the html files"
 })
.option('dirname', {
    abbr: 'd',
    help: "the name of the folder that will store the html files"
 })
.callback(save)
.help("save a static website from the .md files on a given folder (defaults to current folder)");
/*
 * Method: init
 */
var init = function(opts) {
  var config = {};
  if(opts[1]) { 
    config.content = Path.resolve(opts[1]); 
  } else { 
    config.content = process.cwd();
  }
  if(opts.out) {
    config.outputFolder = opts.out; 
  }
  note.init(config);
};
parser.command('init')
.option('out', {
    abbr: 'o',
    help: "a folder to save the scaffolding files"
 })
.callback(init)
.help("generate a folder with .md files to help you start your project");
/*
 * do your magic, nomnom
 */
parser.parse();